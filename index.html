<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>M√≠t t·ªù Lee - L√¨ X√¨ 2026</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(#fff3e0,#fffaf2);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:16px;
}

.card{
  width:100%;
  max-width:420px;
  background:#fff;
  border-radius:20px;
  padding:28px 20px 32px;
  box-shadow:0 20px 50px rgba(0,0,0,.12);
  text-align:center;
}

.logo{
  font-size:30px;
  font-weight:900;
  color:#d32f2f;
}
.subtitle{
  margin-top:6px;
  color:#888;
}

input,button{
  width:100%;
  height:56px;
  margin-top:18px;
  border-radius:14px;
  font-size:17px;
  box-sizing:border-box;
}

/* INPUT */
input{
  padding:0 16px;
  border:1.5px solid #ddd;
}
input:focus{
  outline:none;
  border-color:#d32f2f;
}

/* BUTTON */
button{
  border:none;
  font-weight:800;
  color:#fff;
  background:linear-gradient(135deg,#d32f2f,#ff7043);
}
button:active{ transform:scale(.97); }

#result{
  margin-top:22px;
  font-size:20px;
  font-weight:700;
}

.footer{
  margin-top:18px;
  color:#999;
  font-size:14px;
}

/* PH√ÅO HOA */
canvas{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:999;
}
</style>
</head>

<body>

<div class="card">
  <div class="logo">üßß M√≠t t·ªù Lee üßß</div>
  <div class="subtitle">L√¨ X√¨ May M·∫Øn ‚Ä¢ Xu√¢n 2026</div>

  <input id="name" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n">
  <button id="btn" onclick="draw()">üéÅ B·ªêC L√å X√å</button>

  <div id="result"></div>
  <div class="footer">Ch√∫c m·ª´ng nƒÉm m·ªõi ‚Ä¢ An khang ‚Ä¢ Th·ªãnh v∆∞·ª£ng</div>
</div>

<canvas id="fireworks"></canvas>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, doc, getDoc,
  collection, getDocs, runTransaction
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* üî• FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyCLGVLJ-S2uyptD8-0I5MrqeOOBE6g2AD0",
  authDomain: "premium-bastion-300803.firebaseapp.com",
  projectId: "premium-bastion-300803",
  storageBucket: "premium-bastion-300803.firebasestorage.app",
  messagingSenderId: "665922128360",
  appId: "1:665922128360:web:65594fbeb2123fb0a07c5d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* DEVICE ID */
let deviceId = localStorage.getItem("lixi_device");
if(!deviceId){
  deviceId = crypto.randomUUID();
  localStorage.setItem("lixi_device",deviceId);
}

/* B·ªêC L√å X√å */
async function draw(){
  const name = document.getElementById("name").value.trim();
  if(!name) return alert("Vui l√≤ng nh·∫≠p t√™n");

  const result = document.getElementById("result");
  const btn = document.getElementById("btn");
  btn.disabled = true;

  try{
    await runTransaction(db, async (t)=>{
      const userRef = doc(db,"lixi",deviceId);
      if((await t.get(userRef)).exists()){
        throw "‚ùå Thi·∫øt b·ªã n√†y ƒë√£ b·ªëc r·ªìi";
      }

      const prizes = await getDocs(collection(db,"prizes"));
      const available=[];
      prizes.forEach(p=>{
        const d=p.data();
        if(d.qty>0) available.push({id:p.id,...d});
      });
      if(!available.length) throw "üò¢ ƒê√£ h·∫øt l√¨ x√¨";

      const prize = available[Math.floor(Math.random()*available.length)];
      t.update(doc(db,"prizes",prize.id),{qty:prize.qty-1});
      t.set(userRef,{
        name,
        prize:prize.name,
        value:prize.value,
        time:new Date().toISOString()
      });

      result.innerHTML=`
        üéâ <b>${name}</b><br>
        üßß <span style="color:#d32f2f">${prize.name} ‚Äì ${prize.value}</span>
      `;
      launchFireworks();
    });
  }catch(e){
    result.innerHTML = e;
  }
  btn.disabled=false;
}

/* üéÜ PH√ÅO HOA */
const canvas=document.getElementById("fireworks");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

function launchFireworks(){
  let particles=[];
  for(let i=0;i<120;i++){
    particles.push({
      x:canvas.width/2,
      y:canvas.height/2,
      vx:(Math.random()-0.5)*8,
      vy:(Math.random()-0.5)*8,
      life:60+Math.random()*20,
      color:`hsl(${Math.random()*360},100%,60%)`
    });
  }
  function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    particles.forEach(p=>{
      p.x+=p.vx;
      p.y+=p.vy;
      p.life--;
      ctx.fillStyle=p.color;
      ctx.fillRect(p.x,p.y,3,3);
    });
    particles=particles.filter(p=>p.life>0);
    if(particles.length) requestAnimationFrame(animate);
  }
  animate();
}

window.onresize=()=>{
  canvas.width=innerWidth;
  canvas.height=innerHeight;
};
</script>

</body>
</html>
