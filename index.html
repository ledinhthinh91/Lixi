<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>MÃ­t tá» Lee â€“ LÃ¬ XÃ¬ 2026</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:Arial;
  background:#ffecd2;
  text-align:center;
  padding:20px;
}
.box{
  background:#fff;
  max-width:360px;
  margin:auto;
  padding:20px;
  border-radius:12px;
}
button{
  background:#d32f2f;
  color:#fff;
  border:none;
  padding:14px;
  width:100%;
  border-radius:8px;
  font-size:16px;
}
input{
  width:100%;
  padding:12px;
  margin-bottom:10px;
}
#result{margin-top:15px;font-size:18px;font-weight:bold}
</style>
</head>

<body>

<h2>ğŸ§§ MÃT Tá»œ LEE ğŸ§§</h2>
<p>LÃ¬ XÃ¬ 2026</p>

<div class="box">
<input id="name" placeholder="Nháº­p tÃªn cá»§a báº¡n">
<button id="btn">ğŸ Bá»C LÃŒ XÃŒ</button>
<div id="result"></div>
</div>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCLGVLJ-S2uyptD8-0I5MrqeOOBE6g2AD0",
  authDomain: "premium-bastion-300803.firebaseapp.com",
  projectId: "premium-bastion-300803"
});

const db = firebase.firestore();

let deviceId = localStorage.getItem("lixi_device");
if(!deviceId){
  deviceId = Date.now()+"_"+Math.random();
  localStorage.setItem("lixi_device",deviceId);
}

document.getElementById("btn").onclick = async () => {
  const name = document.getElementById("name").value.trim();
  const result = document.getElementById("result");
  if(!name) return alert("Nháº­p tÃªn");

  const userRef = db.collection("lixi").doc(deviceId);
  const userSnap = await userRef.get();
  if(userSnap.exists){
    result.innerHTML="âŒ Báº¡n Ä‘Ã£ bá»‘c rá»“i";
    return;
  }

  const prizesSnap = await db.collection("prizes").get();
  const available=[];
  prizesSnap.forEach(p=>{
    if(p.data().qty>0) available.push(p);
  });
  if(!available.length){
    result.innerHTML="ğŸ˜¢ Háº¿t lÃ¬ xÃ¬";
    return;
  }

  const prizeDoc = available[Math.floor(Math.random()*available.length)];
  const prize = prizeDoc.data();

  await db.runTransaction(async t=>{
    t.update(prizeDoc.ref,{qty:prize.qty-1});
    t.set(userRef,{
      name,
      prize:prize.name,
      value:prize.value,
      time:new Date().toISOString()
    });
  });

  result.innerHTML=`ğŸ‰ ${name}<br>ğŸ§§ ${prize.name} â€“ ${prize.value}`;
};
</script>

</body>
</html>
