<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ğŸ§§ LÃ¬ XÃ¬ Äáº§u NÄƒm 2026</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial;
  background:linear-gradient(#fff3e0,#ffe0b2);
  text-align:center;
  padding:40px 16px;
}
h1{color:#c62828}
input,button{
  width:100%;
  max-width:320px;
  padding:14px;
  margin:12px auto;
  font-size:16px;
  border-radius:8px;
}
input{border:1px solid #ccc}
button{
  background:#d32f2f;
  color:white;
  border:none;
  font-weight:bold;
}
button:disabled{background:#aaa}
#result{
  margin-top:24px;
  font-size:20px;
  font-weight:bold;
}
.firework{
  position:fixed;
  width:6px;height:6px;
  background:red;
  animation:boom 1s linear forwards;
}
@keyframes boom{
  to{
    transform:translate(var(--x),var(--y)) scale(0);
    opacity:0;
  }
}
</style>
</head>
<body>

<h1>ğŸ§§ LÃŒ XÃŒ Äáº¦U NÄ‚M 2026 ğŸ§§</h1>
<p>Nháº­p tÃªn â€“ nháº¥n bá»‘c â€“ chá» Ä‘iá»u báº¥t ngá» ğŸ‰</p>

<input id="name" placeholder="Nháº­p tÃªn cá»§a báº¡n">
<button id="btn" onclick="draw()">ğŸ Bá»C LÃŒ XÃŒ</button>

<div id="result"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, doc, getDoc, setDoc,
  collection, getDocs, runTransaction
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ğŸ”¥ FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyCLGVLJ-S2uyptD8-0I5MrqeOOBE6g2AD0",
  authDomain: "premium-bastion-300803.firebaseapp.com",
  projectId: "premium-bastion-300803"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ğŸ” ID THIáº¾T Bá»Š */
let deviceId = localStorage.getItem("lixi_device");
if(!deviceId){
  deviceId = crypto.randomUUID();
  localStorage.setItem("lixi_device",deviceId);
}

/* ğŸ† PHÃO HOA */
function firework(){
  for(let i=0;i<20;i++){
    const f=document.createElement("div");
    f.className="firework";
    f.style.left="50%";
    f.style.top="40%";
    f.style.setProperty("--x",(Math.random()*300-150)+"px");
    f.style.setProperty("--y",(Math.random()*300-150)+"px");
    f.style.background=`hsl(${Math.random()*360},100%,50%)`;
    document.body.appendChild(f);
    setTimeout(()=>f.remove(),1000);
  }
}

/* ğŸ Bá»C LÃŒ XÃŒ */
window.draw = async ()=>{
  const name=document.getElementById("name").value.trim();
  const btn=document.getElementById("btn");
  const result=document.getElementById("result");

  if(!name) return alert("Vui lÃ²ng nháº­p tÃªn");

  btn.disabled=true;
  result.innerHTML="â³ Äang bá»‘c lÃ¬ xÃ¬...";

  try{
    await runTransaction(db,async(tran)=>{
      /* kiá»ƒm tra Ä‘Ã£ bá»‘c */
      const userRef=doc(db,"lixi",deviceId);
      const userSnap=await tran.get(userRef);
      if(userSnap.exists()) throw "âŒ Báº¡n Ä‘Ã£ bá»‘c lÃ¬ xÃ¬ rá»“i";

      /* láº¥y giáº£i cÃ²n */
      const snap=await getDocs(collection(db,"prizes"));
      let available=[], total=0;
      snap.forEach(p=>{
        const d=p.data();
        total+=d.qty;
        if(d.qty>0) available.push({id:p.id,...d});
      });

      if(total<=0){
        btn.disabled=true;
        throw "ğŸ‰ ÄÃƒ Háº¾T LÃŒ XÃŒ â€“ CHÃšC Má»ªNG NÄ‚M Má»šI ğŸ‰";
      }

      const prize=available[Math.floor(Math.random()*available.length)];
      tran.update(doc(db,"prizes",prize.id),{qty:prize.qty-1});
      tran.set(userRef,{
        name, prize:prize.name, value:prize.value,
        time:new Date().toISOString()
      });

      result.innerHTML=`
        ğŸŠ ChÃºc má»«ng <b>${name}</b><br>
        ğŸ§§ ${prize.name} â€“ <span style="color:#d32f2f">${prize.value}</span>
      `;
      firework();
    });
  }catch(e){
    result.innerHTML=e;
    btn.disabled=false;
  }
};
</script>

</body>
</html>
