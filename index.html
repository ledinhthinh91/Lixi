<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>MÃ­t tá» Lee â€“ LÃ¬ XÃ¬ 2026</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: Arial, sans-serif;
  background: linear-gradient(180deg,#ffecd2,#fcb69f);
  text-align:center;
  padding:24px;
}
h1{
  color:#c62828;
  margin-bottom:8px;
}
.box{
  background:#fff;
  max-width:360px;
  margin:auto;
  padding:20px;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.15);
}
input,button{
  width:100%;
  padding:14px;
  margin:10px 0;
  font-size:16px;
  border-radius:8px;
}
input{border:1px solid #ccc}
button{
  background:#d32f2f;
  color:#fff;
  border:none;
  font-weight:bold;
}
#result{
  margin-top:16px;
  font-size:18px;
  font-weight:bold;
}
.firework{
  animation:pop 0.6s ease infinite alternate;
}
@keyframes pop{
  from{transform:scale(1)}
  to{transform:scale(1.05)}
}
</style>
</head>

<body>

<h1>ğŸ§§ MÃT Tá»œ LEE ğŸ§§</h1>
<p>LÃ¬ XÃ¬ Äáº§u NÄƒm 2026</p>

<div class="box">
  <input id="name" placeholder="Nháº­p tÃªn cá»§a báº¡n">
  <button onclick="draw()">ğŸ Bá»C LÃŒ XÃŒ</button>
  <div id="result"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, doc, setDoc, getDocs,
  collection, runTransaction
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCLGVLJ-S2uyptD8-0I5MrqeOOBE6g2AD0",
  authDomain: "premium-bastion-300803.firebaseapp.com",
  projectId: "premium-bastion-300803",
  storageBucket: "premium-bastion-300803.firebasestorage.app",
  messagingSenderId: "665922128360",
  appId: "1:665922128360:web:65594fbeb2123fb0a07c5d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let deviceId = localStorage.getItem("lixi_device");
if(!deviceId){
  deviceId = crypto.randomUUID();
  localStorage.setItem("lixi_device",deviceId);
}

async function draw(){
  const name = document.getElementById("name").value.trim();
  const result = document.getElementById("result");
  if(!name) return alert("Vui lÃ²ng nháº­p tÃªn");

  try{
    await runTransaction(db, async (tx)=>{
      const userRef = doc(db,"lixi",deviceId);
      const userSnap = await tx.get(userRef);
      if(userSnap.exists()) throw "âŒ Báº¡n Ä‘Ã£ bá»‘c rá»“i";

      const prizeSnap = await getDocs(collection(db,"prizes"));
      const available=[];
      prizeSnap.forEach(p=>{
        if(p.data().qty>0) available.push({id:p.id,...p.data()});
      });
      if(!available.length) throw "ğŸ˜¢ ÄÃ£ háº¿t lÃ¬ xÃ¬";

      const prize = available[Math.floor(Math.random()*available.length)];
      tx.update(doc(db,"prizes",prize.id),{qty:prize.qty-1});

      tx.set(userRef,{
        name,
        prize:prize.name,
        value:prize.value,
        time:new Date().toISOString()
      });

      result.innerHTML = `
        <div class="firework">
        ğŸ‰ <b>${name}</b><br>
        Nháº­n Ä‘Æ°á»£c<br>
        ğŸ§§ <span style="color:#d32f2f">${prize.name} â€“ ${prize.value}</span>
        </div>`;
    });
  }catch(e){
    result.innerHTML = e;
  }
}
</script>

</body>
</html>
